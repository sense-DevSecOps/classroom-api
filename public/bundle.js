(()=>{"use strict";const e="PLACEHOLDER_CLIENT_ID",t="PLACEHOLDER_API_KEY";let n=null;let s,o,i,a,c,l,d,r,u,m,g,p,y,h,E=null,C=!1;function f(e,t=!1){c.textContent=e,c.className=t?"status error":"status",console.log(e)}function I(e){l.style.display=e?"block":"none"}async function v(){if(e&&t){I(!0),f("Loading Google API Client...");try{await gapi.load("client",(async()=>{await gapi.client.init({apiKey:t,discoveryDocs:["https://classroom.googleapis.com/$discovery/rest?version=v1"]}),f("API client loaded. Initializing authentication..."),function(){I(!0);try{s=google.accounts.oauth2.initTokenClient({client_id:e,scope:"https://www.googleapis.com/auth/classroom.courses.readonly https://www.googleapis.com/auth/classroom.rosters.readonly https://www.googleapis.com/auth/classroom.coursework.me https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.student-submissions.me.readonly https://www.googleapis.com/auth/classroom.student-submissions.students.readonly",callback:e=>{e&&e.access_token?(E=e.access_token,C=!0,w(!0),A()):(f("Authentication failed. No access token received.",!0),w(!1)),I(!1)},error_callback:e=>{console.error("Authentication error",e),f("Authentication error: "+e.message,!0),w(!1),I(!1)}}),function(){const e=document.getElementById("google-signin-button");e.innerHTML="";const t=document.createElement("button");t.textContent="Sign in with Google",t.classList.add("button"),t.addEventListener("click",(()=>{s.requestAccessToken()})),e.appendChild(t),f("Authentication ready. Please sign in with your Google account.")}()}catch(e){console.error("Error initializing auth",e),f("Error initializing authentication: "+(e.message||JSON.stringify(e)),!0),I(!1)}}()}))}catch(e){I(!1),console.error("Error initializing the API client",e),f("Error initializing the API client: "+(e.message||JSON.stringify(e)),!0)}}else f("Missing API credentials. Please check your environment configuration.",!0)}function w(e){e?(o.style.display="none",i.style.display="flex",d.style.display="inline-block",hideAllCards(),m.style.display="block",f("Successfully signed in. Loading your classes...")):(o.style.display="block",i.style.display="none",d.style.display="none",f("Please sign in to access Google Classroom."))}function k(){google.accounts.oauth2.revoke(E,(()=>{E=null,C=!1,w(!1),f("Signed out successfully.")}))}function A(){(C||(f("You need to sign in first.",!0),0))&&(I(!0),f("Loading your classes..."),a.innerHTML="",n=[],gapi.client.classroom.courses.list({pageSize:20,courseStates:["ACTIVE"]}).then((e=>{const t=e.result.courses||[];if(n=t,t.length>0)t.forEach((e=>{const t=document.createElement("div");t.className="class-item",t.dataset.id=e.id;const n=document.createElement("div");n.className="class-name",n.textContent=e.name;const s=document.createElement("div");s.textContent=e.section||"";const o=document.createElement("div");o.className="class-options";const i=document.createElement("span");i.className="class-option",i.textContent="Details",i.addEventListener("click",(t=>{t.stopPropagation(),showClassDetails(e.id)}));const c=document.createElement("span");c.className="class-option",c.textContent="Students",c.addEventListener("click",(t=>{t.stopPropagation(),fetchStudents(e.id)}));const l=document.createElement("span");l.className="class-option",l.textContent="Assignments",l.addEventListener("click",(t=>{t.stopPropagation(),fetchAssignments(e.id)}));const d=document.createElement("span");d.className="class-option",d.textContent="Submissions",d.addEventListener("click",(t=>{t.stopPropagation(),prepareSubmissions(e.id)})),o.appendChild(i),o.appendChild(c),o.appendChild(l),o.appendChild(d),t.appendChild(n),t.appendChild(s),t.appendChild(o),t.addEventListener("click",(()=>{showClassDetails(e.id)})),a.appendChild(t)})),f(`Successfully loaded ${t.length} classes.`);else{const e=document.createElement("div");e.className="class-item",e.textContent="No classes found.",a.appendChild(e),f("No classes found. Are you sure you're enrolled in any Google Classroom courses?")}})).catch((e=>{console.error("Error fetching classes",e),f("Error fetching classes: "+(e.message||JSON.stringify(e)),!0);const t=document.createElement("div");t.className="class-item",t.textContent="Failed to load classes. "+(e.message||""),a.appendChild(t)})).finally((()=>{I(!1)})))}document.addEventListener("DOMContentLoaded",(()=>{o=document.getElementById("setup-area"),i=document.getElementById("main-container"),a=document.getElementById("classes-list"),c=document.getElementById("status-message"),l=document.getElementById("loading"),d=document.getElementById("signout-button"),r=document.getElementById("save-credentials"),u=document.getElementById("refresh-classes"),m=document.getElementById("welcome-card"),g=document.getElementById("class-detail-card"),p=document.getElementById("students-card"),y=document.getElementById("assignments-card"),h=document.getElementById("submissions-card"),function(){const n=document.getElementById("credentials-info");e&&t?(n.textContent="API credentials are securely loaded from environment variables.",f("Credentials loaded. Click 'Initialize API' to proceed."),r.textContent="Initialize API"):(n.textContent="ERROR: API credentials not found in environment variables.",f("Missing API credentials. Please check your .env file and rebuild.",!0)),r.addEventListener("click",v),d.addEventListener("click",k),u.addEventListener("click",A),document.getElementById("view-submissions").addEventListener("click",viewSelectedSubmissions)}()}))})();