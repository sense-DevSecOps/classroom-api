(()=>{"use strict";const e="606661610781-t1fgt6kdqi8see1he837s6dqg1sbpi7l.apps.googleusercontent.com",t="AIzaSyCm4vaBRV7Xd-e57rDQRpry7C76Miv0H0E";let n=[],o="ACTIVE";let s,i,l,a,c,r,d,g,u,m,p,h,y,E,I,v,w=null,f=!1;function C(e,t=!1){c.textContent=e,c.className=t?"status error":"status",console.log(e)}function k(e){r.style.display=e?"block":"none"}function A(e){e?(i.style.display="none",l.style.display="flex",d.style.display="inline-block",hideAllCards(),u.style.display="block",C("Successfully signed in. Loading your classes...")):(i.style.display="block",l.style.display="none",d.style.display="none",C("Please sign in to access Google Classroom."))}function P(){google.accounts.oauth2.revoke(w,(()=>{w=null,f=!1,A(!1),C("Signed out successfully.")}))}function L(e){o=e,"ACTIVE"===e?(E.classList.add("active"),I.classList.remove("active")):(E.classList.remove("active"),I.classList.add("active")),b()}function b(){if(!n||0===n.length)return void N();a.innerHTML="";const e=n.filter((e=>e.courseState===o));if(e.length>0)e.forEach(S),C(`Showing ${e.length} ${o.toLowerCase()} classes.`);else{const e=document.createElement("div");e.className="class-item",e.textContent=`No ${o.toLowerCase()} classes found.`,a.appendChild(e),C(`No ${o.toLowerCase()} classes found.`)}}function S(e){const t=document.createElement("div");t.className="class-item",t.dataset.id=e.id;const n=document.createElement("div");n.className="class-name",n.textContent=e.name;const o=document.createElement("div");o.textContent=e.section||"";const s=document.createElement("div");s.className="class-options";const i=document.createElement("span");i.className="class-option",i.textContent="Details",i.addEventListener("click",(t=>{t.stopPropagation(),showClassDetails(e.id)}));const l=document.createElement("span");l.className="class-option",l.textContent="Students",l.addEventListener("click",(t=>{t.stopPropagation(),fetchStudents(e.id)}));const c=document.createElement("span");c.className="class-option",c.textContent="Assignments",c.addEventListener("click",(t=>{t.stopPropagation(),fetchAssignments(e.id)}));const r=document.createElement("span");r.className="class-option",r.textContent="Submissions",r.addEventListener("click",(t=>{t.stopPropagation(),prepareSubmissions(e.id)})),s.appendChild(i),s.appendChild(l),s.appendChild(c),s.appendChild(r),t.appendChild(n),t.appendChild(o),t.appendChild(s),t.addEventListener("click",(()=>{showClassDetails(e.id)})),a.appendChild(t)}function N(){(f||(C("You need to sign in first.",!0),0))&&(k(!0),C("Loading your classes..."),a.innerHTML="",n=[],console.log("Fetching all classes to filter later"),gapi.client.classroom.courses.list({pageSize:100,courseStates:["ACTIVE","ARCHIVED","PROVISIONED","DECLINED","SUSPENDED"]}).then((e=>{console.log("Received classes response:",e);const t=e.result.courses||[];if(n=t,b(),0===t.length){const e=document.createElement("div");e.className="class-item",e.textContent="No classes found at all.",a.appendChild(e),C("No classes found. Are you sure you're enrolled in any Google Classroom courses?")}})).catch((e=>{console.error("Error fetching classes",e),C("Error fetching classes: "+(e.message||JSON.stringify(e)),!0);const t=document.createElement("div");t.className="class-item",t.textContent="Failed to load classes. "+(e.message||""),a.appendChild(t)})).finally((()=>{k(!1)})))}document.addEventListener("DOMContentLoaded",(()=>{i=document.getElementById("setup-area"),l=document.getElementById("main-container"),a=document.getElementById("classes-list"),c=document.getElementById("status-message"),r=document.getElementById("loading"),d=document.getElementById("signout-button"),v=document.getElementById("google-signin-button"),g=document.getElementById("refresh-classes"),u=document.getElementById("welcome-card"),m=document.getElementById("class-detail-card"),p=document.getElementById("students-card"),h=document.getElementById("assignments-card"),y=document.getElementById("submissions-card"),e?(d.addEventListener("click",P),g.addEventListener("click",N),document.getElementById("view-submissions").addEventListener("click",viewSelectedSubmissions),E=document.getElementById("active-classes-btn"),I=document.getElementById("archived-classes-btn"),E.addEventListener("click",(()=>{L("ACTIVE")})),I.addEventListener("click",(()=>{L("ARCHIVED")})),C("Initializing Google Classroom API..."),async function(){if(!e)return C("Missing API credentials. Please check your environment configuration.",!0),void console.error("API credentials are missing or invalid",{clientIdPresent:!!e,apiKeyPresent:!0});if(console.log("Initializing with credentials",{clientIdLength:e?e.length:0,apiKeyLength:t?39:0,clientIdPrefix:e?e.substring(0,5)+"...":"missing"}),k(!0),C("Loading Google API Client..."),!window.gapi)return k(!1),C("Google API client not loaded. Please check your internet connection and try again.",!0),void console.error("gapi not available");try{console.log("Starting Google API client loading"),await new Promise(((e,t)=>{const n=setTimeout((()=>{t(new Error("Timeout loading Google API client"))}),15e3);gapi.load("client",{callback:()=>{clearTimeout(n),e()},onerror:e=>{clearTimeout(n),t(e)},timeout:1e4,ontimeout:()=>{clearTimeout(n),t(new Error("Google API client load timed out"))}})})),console.log("GAPI client loaded, initializing with API key"),await gapi.client.init({apiKey:t,discoveryDocs:["https://classroom.googleapis.com/$discovery/rest?version=v1"]}),console.log("API client initialization successful"),C("API client loaded. Initializing authentication..."),function(){if(k(!0),!window.google||!window.google.accounts||!window.google.accounts.oauth2)return console.error("Google Identity Services not available"),C("Google authentication services not loaded. Please check your internet connection and try again.",!0),void k(!1);console.log("Initializing Google authentication with client ID");try{console.log("Creating token client with client ID",e?"(valid)":"(missing)"),s=google.accounts.oauth2.initTokenClient({client_id:e,scope:"https://www.googleapis.com/auth/classroom.courses.readonly https://www.googleapis.com/auth/classroom.rosters.readonly https://www.googleapis.com/auth/classroom.coursework.me https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.student-submissions.me.readonly https://www.googleapis.com/auth/classroom.student-submissions.students.readonly",callback:e=>{console.log("Token response received",e?"with data":"empty"),e&&e.access_token?(w=e.access_token,f=!0,console.log("Authentication successful, updating UI"),A(!0),N()):(console.error("No access token in response",e),C("Authentication failed. No access token received.",!0),A(!1)),k(!1)},error_callback:e=>{console.error("Authentication error",e),C("Authentication error: "+(e.message||"Unknown error"),!0),A(!1),k(!1)}});const t=document.getElementById("manual-google-btn");t?(console.log("Setting up Google Sign In button click handler"),t.onclick=()=>{console.log("Google Sign In button clicked"),!f&&s?(C("Starting Google authentication..."),s.requestAccessToken()):f?C("Already authenticated!"):C("Token client not initialized. Please refresh the page.",!0)}):console.error("Manual Google button not found in the DOM"),console.log("Token client initialized successfully")}catch(e){console.error("Error initializing auth",e),C("Error initializing authentication: "+(e.message||JSON.stringify(e)),!0),k(!1)}}()}catch(e){k(!1),console.error("Error initializing the API client",e),C("Error initializing the API client: "+(e.message||JSON.stringify(e)),!0)}}()):C("Error: API credentials not found. Please check configuration.",!0)}))})();